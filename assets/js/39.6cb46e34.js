(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{374:function(n,s,e){"use strict";e.r(s);var a=e(3),t=Object(a.a)({},(function(){var n=this,s=n.$createElement,e=n._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("p",[n._v("生产者")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('public class WorkProducer {\n\n    public static void main(String[] args) throws IOException, TimeoutException, InterruptedException {\n\n\n        Connection connection = ConnectionUtil.getConnection();\n\n        Channel channel = connection.createChannel();\n\n        channel.queueDeclare("work_queue", false,false,false,null);\n\t\t\n       /**\n         * 消费者回复确认之前至多发送一条数据给消费者（限制分发）\n         * 同时消费者需关闭自动应答，采用手动应答\n         */\n        //channel.basicQos(1);\n\t\t\n        String msg = "msg ";\n        for(int i = 0; i < 50; i++){\n            channel.basicPublish("", "work_queue", null, (msg + i).getBytes());\n            System.out.println("send: msg " + i);\n            TimeUnit.SECONDS.sleep(1);\n        }\n\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br")])]),e("p",[n._v("消费者1 较消费者2消费快")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('public class WorkConsumer {\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n\n        //创建连接\n        Connection connection = ConnectionUtil.getConnection();\n\n        try{\n            //创建通道\n            Channel channel = connection.createChannel();\n\n            //队列声明，不声明也可以\n            channel.queueDeclare("work_queue", false, false,false, null);\n\n            DefaultConsumer consumer = new DefaultConsumer(channel){\n                @Override\n                public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                    System.out.println("recv[1]: "+new String(body, StandardCharsets.UTF_8));\n                }\n            };\n\n            boolean autoAck = false;//\n            //监听队列\n            channel.basicConsume("work_queue", autoAck, consumer);\n            TimeUnit.SECONDS.sleep(1);\n\n        }catch (Exception e){\n            e.printStackTrace();\n        }\n    }\n    \nrecv[1]: msg 1\nrecv[1]: msg 3\nrecv[1]: msg 5\nrecv[1]: msg 7\nrecv[1]: msg 9\nrecv[1]: msg 11\nrecv[1]: msg 13\nrecv[1]: msg 15\nrecv[1]: msg 17\nrecv[1]: msg 19\nrecv[1]: msg 21\nrecv[1]: msg 23\nrecv[1]: msg 25\nrecv[1]: msg 27\nrecv[1]: msg 29\nrecv[1]: msg 31\nrecv[1]: msg 33\nrecv[1]: msg 35\nrecv[1]: msg 37\nrecv[1]: msg 39\nrecv[1]: msg 41\nrecv[1]: msg 43\nrecv[1]: msg 45\nrecv[1]: msg 47\nrecv[1]: msg 49\n}\n\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br"),e("span",{staticClass:"line-number"},[n._v("45")]),e("br"),e("span",{staticClass:"line-number"},[n._v("46")]),e("br"),e("span",{staticClass:"line-number"},[n._v("47")]),e("br"),e("span",{staticClass:"line-number"},[n._v("48")]),e("br"),e("span",{staticClass:"line-number"},[n._v("49")]),e("br"),e("span",{staticClass:"line-number"},[n._v("50")]),e("br"),e("span",{staticClass:"line-number"},[n._v("51")]),e("br"),e("span",{staticClass:"line-number"},[n._v("52")]),e("br"),e("span",{staticClass:"line-number"},[n._v("53")]),e("br"),e("span",{staticClass:"line-number"},[n._v("54")]),e("br"),e("span",{staticClass:"line-number"},[n._v("55")]),e("br"),e("span",{staticClass:"line-number"},[n._v("56")]),e("br"),e("span",{staticClass:"line-number"},[n._v("57")]),e("br"),e("span",{staticClass:"line-number"},[n._v("58")]),e("br")])]),e("p",[n._v("消费者2 较消费者1消费慢")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('public class WorkConsumer2 {\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n\n        //创建连接\n        Connection connection = ConnectionUtil.getConnection();\n\n        try{\n            //创建通道\n            Channel channel = connection.createChannel();\n\n            //队列声明，不声明也可以\n            channel.queueDeclare("work_queue", false, false,false, null);\n\n            DefaultConsumer consumer = new DefaultConsumer(channel){\n                @Override\n                public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                    System.out.println("recv[2]: " + new String(body, StandardCharsets.UTF_8));\n                    try {\n                        TimeUnit.SECONDS.sleep(5);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            };\n\t\tboolean autoAck = false;\n            //监听队列  autoAck 为true  轮询分发（公平分发）  反之为限制分发\n            channel.basicConsume("work_queue", autoAck, consumer);\n        }catch (Exception e){\n            e.printStackTrace();\n        }\n    }\n    \nrecv[2]: msg 0\nrecv[2]: msg 2\nrecv[2]: msg 4\nrecv[2]: msg 6\nrecv[2]: msg 8\nrecv[2]: msg 10\nrecv[2]: msg 12\nrecv[2]: msg 14\nrecv[2]: msg 16\nrecv[2]: msg 18\nrecv[2]: msg 20\nrecv[2]: msg 22\nrecv[2]: msg 24\nrecv[2]: msg 26\nrecv[2]: msg 28\nrecv[2]: msg 30\nrecv[2]: msg 32\nrecv[2]: msg 34\nrecv[2]: msg 36\nrecv[2]: msg 38\nrecv[2]: msg 40\nrecv[2]: msg 42\nrecv[2]: msg 44\nrecv[2]: msg 46\nrecv[2]: msg 48\n}\n\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br"),e("span",{staticClass:"line-number"},[n._v("45")]),e("br"),e("span",{staticClass:"line-number"},[n._v("46")]),e("br"),e("span",{staticClass:"line-number"},[n._v("47")]),e("br"),e("span",{staticClass:"line-number"},[n._v("48")]),e("br"),e("span",{staticClass:"line-number"},[n._v("49")]),e("br"),e("span",{staticClass:"line-number"},[n._v("50")]),e("br"),e("span",{staticClass:"line-number"},[n._v("51")]),e("br"),e("span",{staticClass:"line-number"},[n._v("52")]),e("br"),e("span",{staticClass:"line-number"},[n._v("53")]),e("br"),e("span",{staticClass:"line-number"},[n._v("54")]),e("br"),e("span",{staticClass:"line-number"},[n._v("55")]),e("br"),e("span",{staticClass:"line-number"},[n._v("56")]),e("br"),e("span",{staticClass:"line-number"},[n._v("57")]),e("br"),e("span",{staticClass:"line-number"},[n._v("58")]),e("br"),e("span",{staticClass:"line-number"},[n._v("59")]),e("br"),e("span",{staticClass:"line-number"},[n._v("60")]),e("br")])]),e("blockquote",[e("h3",{attrs:{id:"轮询分发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#轮询分发"}},[n._v("#")]),n._v(" "),e("strong",[n._v("轮询分发")])]),n._v(" "),e("blockquote",[e("ol",[e("li",[n._v("消息队列并不清楚各队列处理数据的能力（速度快慢）")]),n._v(" "),e("li",[n._v("无论队列处理快慢，进行公平分发，所有队列处理的数据量相同")])])]),n._v(" "),e("h3",{attrs:{id:"限制分发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#限制分发"}},[n._v("#")]),n._v(" "),e("strong",[n._v("限制分发")])]),n._v(" "),e("blockquote",[e("ol",[e("li",[n._v("生产者、消费者设置 channel.basicQos(1); 表示消费者回复确认之前，生产者每次最多发一条数据给消费者"),e("br"),n._v(" "),e("p",{staticStyle:{color:"red","font-size":"16px"}},[n._v("存疑，生产者是否必须设置？")])])])]),n._v(" "),e("blockquote",[e("ol",{attrs:{start:"2"}},[e("li",[n._v("消费者需关闭自动确认")]),n._v(" "),e("li",[n._v("处理能力高的队列处理更多的数据")])])])])])}),[],!1,null,null,null);s.default=t.exports}}]);
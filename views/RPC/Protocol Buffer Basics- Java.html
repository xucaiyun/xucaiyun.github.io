<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Google Protocol Buffers Tutorials (Java) | SinkDream</title>
    <meta name="description" content="人问寒山道，寒山路不通">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.22e32940.css" as="style"><link rel="preload" href="/assets/js/app.bbad8388.js" as="script"><link rel="preload" href="/assets/js/3.c52288f4.js" as="script"><link rel="preload" href="/assets/js/1.1b2459ea.js" as="script"><link rel="preload" href="/assets/js/29.264eb514.js" as="script"><link rel="prefetch" href="/assets/js/10.6e4d06da.js"><link rel="prefetch" href="/assets/js/11.fbb4a5da.js"><link rel="prefetch" href="/assets/js/12.492b2ce8.js"><link rel="prefetch" href="/assets/js/13.81e23693.js"><link rel="prefetch" href="/assets/js/14.6ddaf758.js"><link rel="prefetch" href="/assets/js/15.38352b20.js"><link rel="prefetch" href="/assets/js/16.a6aea8cb.js"><link rel="prefetch" href="/assets/js/17.14e81e8d.js"><link rel="prefetch" href="/assets/js/18.f92f321c.js"><link rel="prefetch" href="/assets/js/19.3095d76a.js"><link rel="prefetch" href="/assets/js/20.19c1c4ef.js"><link rel="prefetch" href="/assets/js/21.bb36eaf0.js"><link rel="prefetch" href="/assets/js/22.48a65ddc.js"><link rel="prefetch" href="/assets/js/23.6e6d1043.js"><link rel="prefetch" href="/assets/js/24.101b42a8.js"><link rel="prefetch" href="/assets/js/25.266337e6.js"><link rel="prefetch" href="/assets/js/26.e158cf44.js"><link rel="prefetch" href="/assets/js/27.0fef01f7.js"><link rel="prefetch" href="/assets/js/28.9425d3fa.js"><link rel="prefetch" href="/assets/js/30.e6546098.js"><link rel="prefetch" href="/assets/js/31.080527ae.js"><link rel="prefetch" href="/assets/js/32.412b67ae.js"><link rel="prefetch" href="/assets/js/33.1b4985c4.js"><link rel="prefetch" href="/assets/js/34.492336f3.js"><link rel="prefetch" href="/assets/js/35.6b37bfd6.js"><link rel="prefetch" href="/assets/js/36.49eb47e9.js"><link rel="prefetch" href="/assets/js/37.25ac9730.js"><link rel="prefetch" href="/assets/js/38.9aa580a5.js"><link rel="prefetch" href="/assets/js/39.6cb46e34.js"><link rel="prefetch" href="/assets/js/4.7d147a46.js"><link rel="prefetch" href="/assets/js/40.5ac1b5ff.js"><link rel="prefetch" href="/assets/js/41.afba1bbf.js"><link rel="prefetch" href="/assets/js/42.85c91659.js"><link rel="prefetch" href="/assets/js/43.06c700e4.js"><link rel="prefetch" href="/assets/js/44.3ff71156.js"><link rel="prefetch" href="/assets/js/45.c89b2adf.js"><link rel="prefetch" href="/assets/js/46.5a756cfa.js"><link rel="prefetch" href="/assets/js/5.af61cbef.js"><link rel="prefetch" href="/assets/js/6.bce081b4.js"><link rel="prefetch" href="/assets/js/7.71d6523d.js"><link rel="prefetch" href="/assets/js/8.0ee0330c.js"><link rel="prefetch" href="/assets/js/9.1567fbc6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.22e32940.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-319dd33c><div data-v-319dd33c><div id="loader-wrapper" class="loading-wrapper" data-v-4b73742e data-v-319dd33c data-v-319dd33c><div class="loader-main" data-v-4b73742e><div data-v-4b73742e></div><div data-v-4b73742e></div><div data-v-4b73742e></div><div data-v-4b73742e></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-1e2a0cc0 data-v-319dd33c data-v-319dd33c><h3 class="title" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0>SinkDream</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0><input type="password" value="" data-v-1e2a0cc0> <span data-v-1e2a0cc0>Konck! Knock!</span> <button data-v-1e2a0cc0>OK</button></label> <div class="footer" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0><span data-v-1e2a0cc0><i class="iconfont reco-theme" data-v-1e2a0cc0></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-1e2a0cc0>vuePress-theme-reco</a></span> <span data-v-1e2a0cc0><i class="iconfont reco-copyright" data-v-1e2a0cc0></i> <a data-v-1e2a0cc0><span data-v-1e2a0cc0>sinkdream</span>
            
          <span data-v-1e2a0cc0>2020 - </span>
          2020
        </a></span></div></div> <div class="hide" data-v-319dd33c><header class="navbar" data-v-319dd33c><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="SinkDream" class="logo"> <span class="site-name">SinkDream</span></a> <div class="links"><div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/笔记/" class="nav-link"><i class="iconfont undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/netty/" class="nav-link"><i class="iconfont undefined"></i>
  netty
</a></li><li class="dropdown-item"><!----> <a href="/categories/消息队列/" class="nav-link"><i class="iconfont undefined"></i>
  消息队列
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringBoot/" class="nav-link"><i class="iconfont undefined"></i>
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/categories/linux/" class="nav-link"><i class="iconfont undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/RPC/" class="nav-link"><i class="iconfont undefined"></i>
  RPC
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/note/" class="nav-link"><i class="iconfont reco-document"></i>
  Notes
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      收藏
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/collect/music/" class="nav-link"><i class="iconfont reco-music"></i>
  歌曲
</a></li><li class="dropdown-item"><!----> <a href="/collect/movie/" class="nav-link"><i class="iconfont reco-video"></i>
  电影
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-319dd33c></div> <aside class="sidebar" data-v-319dd33c><div class="personal-info-wrapper" data-v-6c8ffc9c><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-6c8ffc9c> <h3 class="name" data-v-6c8ffc9c>
    sinkdream
  </h3> <div class="num" data-v-6c8ffc9c><div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>28</h3> <h6 data-v-6c8ffc9c>文章</h6></div> <div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>17</h3> <h6 data-v-6c8ffc9c>标签</h6></div></div> <hr data-v-6c8ffc9c></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/笔记/" class="nav-link"><i class="iconfont undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/netty/" class="nav-link"><i class="iconfont undefined"></i>
  netty
</a></li><li class="dropdown-item"><!----> <a href="/categories/消息队列/" class="nav-link"><i class="iconfont undefined"></i>
  消息队列
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringBoot/" class="nav-link"><i class="iconfont undefined"></i>
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/categories/linux/" class="nav-link"><i class="iconfont undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/RPC/" class="nav-link"><i class="iconfont undefined"></i>
  RPC
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/note/" class="nav-link"><i class="iconfont reco-document"></i>
  Notes
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      收藏
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/collect/music/" class="nav-link"><i class="iconfont reco-music"></i>
  歌曲
</a></li><li class="dropdown-item"><!----> <a href="/collect/movie/" class="nav-link"><i class="iconfont reco-video"></i>
  电影
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/Java/Java--依赖、关联、组合、聚合.html" class="sidebar-link">Java--依赖、关联、组合、聚合</a></li><li><a href="/views/Java/公平锁与非公平锁.html" class="sidebar-link">公平锁与非公平锁</a></li><li><a href="/views/Java/接口幂等性.html" class="sidebar-link">接口幂等性</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>RPC</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/RPC/Protocol Buffer Basics- Java.html" class="active sidebar-link">Google Protocol Buffers Tutorials (Java)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#protocol-buffer-basics-java" class="sidebar-link">Protocol Buffer Basics: Java</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#why-use-protocol-buffers" class="sidebar-link">Why Use Protocol Buffers?</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#where-to-find-the-example-code" class="sidebar-link">Where to Find the Example Code</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#defining-your-protocol-format" class="sidebar-link">Defining Your Protocol Format</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#compiling-your-protocol-buffers" class="sidebar-link">Compiling Your Protocol Buffers</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#the-protocol-buffer-api" class="sidebar-link">The Protocol Buffer API</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#enums-and-nested-classes" class="sidebar-link">Enums and Nested Classes</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#builders-vs-messages" class="sidebar-link">Builders vs. Messages</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#parsing-and-serialization" class="sidebar-link">Parsing and Serialization</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#writing-a-message" class="sidebar-link">Writing A Message</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#reading-a-message" class="sidebar-link">Reading A Message</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#extending-a-protocol-buffer" class="sidebar-link">Extending a Protocol Buffer</a></li><li class="sidebar-sub-header"><a href="/views/RPC/Protocol Buffer Basics- Java.html#advanced-usage" class="sidebar-link">Advanced Usage</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>algorithm</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/algorithm/数据结构与算法稀疏数组.html" class="sidebar-link">数据结构与算法(一)稀疏数组</a></li><li><a href="/views/algorithm/红包算法.html" class="sidebar-link">红包算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/linux/防火墙_firewalld.html" class="sidebar-link">firewall</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>mysql</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>netty</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/netty/netty(一)http服务.html" class="sidebar-link">netty(一)http服务器</a></li><li><a href="/views/netty/netty(三)心跳机制.html" class="sidebar-link">netty(三) 长连接、心跳机制</a></li><li><a href="/views/netty/netty(二)聊天室.html" class="sidebar-link">netty(二) 聊天室</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>other</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/other/guide.html" class="sidebar-link">vuepress-theme-reco</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>rabbitmq</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/rabbitmq/01.BasicQueue.html" class="sidebar-link">Rabbitmq(一)BasicQueue</a></li><li><a href="/views/rabbitmq/02.work queues工作队列  .html" class="sidebar-link">Rabbitmq(二)公平分发与限制分发</a></li><li><a href="/views/rabbitmq/03.消息应答（autoAck）及持久化（durable）.html" class="sidebar-link">Rabbitmq(三)消息应答(autoAck)及持久化(durable)</a></li><li><a href="/views/rabbitmq/04.订阅模式.html" class="sidebar-link">Rabbitmq(四) 订阅模式</a></li><li><a href="/views/rabbitmq/05.Exchange（交换机）.html" class="sidebar-link">Rabbitmq(五)Exchange(交换机)</a></li><li><a href="/views/rabbitmq/06.事务与回滚.html" class="sidebar-link">事务机制</a></li><li><a href="/views/rabbitmq/Mac 启动和关闭rabbitmq.html" class="sidebar-link">Mac启动和关闭rabbitmq</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>springboot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/springboot/Springboot2.0解决跨域问题.html" class="sidebar-link">Springboot 2.0 解决跨域问题</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-1e2a0cc0 data-v-319dd33c><h3 class="title" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0>Google Protocol Buffers Tutorials (Java)</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0><input type="password" value="" data-v-1e2a0cc0> <span data-v-1e2a0cc0>Konck! Knock!</span> <button data-v-1e2a0cc0>OK</button></label> <div class="footer" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0><span data-v-1e2a0cc0><i class="iconfont reco-theme" data-v-1e2a0cc0></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-1e2a0cc0>vuePress-theme-reco</a></span> <span data-v-1e2a0cc0><i class="iconfont reco-copyright" data-v-1e2a0cc0></i> <a data-v-1e2a0cc0><span data-v-1e2a0cc0>sinkdream</span>
            
          <span data-v-1e2a0cc0>2020 - </span>
          2020
        </a></span></div></div> <div data-v-319dd33c><main class="page"><div class="page-title" style="display:none;"><h1>Google Protocol Buffers Tutorials (Java)</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>sinkdream</span></i> <i class="iconfont reco-date" data-v-484a899e><span data-v-484a899e>2020-04-02</span></i> <i class="iconfont reco-eye" data-v-484a899e><span id="/views/RPC/Protocol%20Buffer%20Basics-%20Java.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-484a899e><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-484a899e><span class="tag-item" data-v-484a899e>
      protobuf
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="protocol-buffer-basics-java"><a href="#protocol-buffer-basics-java" class="header-anchor">#</a> Protocol Buffer Basics: Java</h2> <p><a href="https://developers.google.cn/protocol-buffers/docs/javatutorial" target="_blank" rel="noopener noreferrer">https://developers.google.cn/protocol-buffers/docs/javatutorial<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>This tutorial provides a basic Java programmer's introduction to working with protocol buffers. By walking through creating a simple example application, it shows you how to</p> <ul><li>Define message formats in a .proto file.</li> <li>Use the protocol buffer compiler.</li> <li>Use the Java protocol buffer API to write and read messages.</li></ul> <p>This isn't a comprehensive guide to using protocol buffers in Java. For more detailed reference information, see the Protocol Buffer Language Guide, the Java API Reference, the Java Generated Code Guide, and the Encoding Reference.</p> <h2 id="why-use-protocol-buffers"><a href="#why-use-protocol-buffers" class="header-anchor">#</a> Why Use Protocol Buffers?</h2> <p>The example we're going to use is a very simple &quot;address book&quot; application that can read and write people's contact details to and from a file. Each person in the address book has a name, an ID, an email address, and a contact phone number.</p> <p>序列话和检索结构化数据
How do you serialize and retrieve structured data like this? There are a few ways to solve this problem:</p> <ul><li><p>Use Java Serialization. This is the default approach since it's built into the language, but it has a host of well-known problems (see Effective Java, by Josh Bloch pp. 213), and also doesn't work very well if you need to share data with applications written in C++ or Python.</p></li> <li><p>You can invent an ad-hoc way to encode the data items into a single string – such as encoding 4 ints as &quot;12:3:-23:67&quot;. This is a simple and flexible approach, although it does require writing one-off encoding and parsing code, and the parsing imposes a small run-time cost. This works best for encoding very simple data.</p></li> <li><p>Serialize the data to XML. This approach can be very attractive since XML is (sort of) human readable and there are binding libraries for lots of languages. This can be a good choice if you want to share data with other applications/projects. However, XML is notoriously space intensive, and encoding/decoding it can impose a huge performance penalty on applications. Also, navigating an XML DOM tree is considerably more complicated than navigating simple fields in a class normally would be.</p></li></ul> <p>Protocol buffers are the flexible, efficient, automated solution to solve exactly this problem. With protocol buffers, you write a .proto description of the data structure you wish to store. From that, the protocol buffer compiler creates a class that implements automatic encoding and parsing of the protocol buffer data with an efficient binary format. The generated class provides getters and setters for the fields that make up a protocol buffer and takes care of the details of reading and writing the protocol buffer as a unit. Importantly, the protocol buffer format supports the idea of extending the format over time in such a way that the code can still read data encoded with the old format.</p> <h2 id="where-to-find-the-example-code"><a href="#where-to-find-the-example-code" class="header-anchor">#</a> Where to Find the Example Code</h2> <p>The example code is included in the source code package, under the &quot;examples&quot; directory. Download it here.</p> <h2 id="defining-your-protocol-format"><a href="#defining-your-protocol-format" class="header-anchor">#</a> Defining Your Protocol Format</h2> <p>To create your address book application, you'll need to start with a .proto file. The definitions in a .proto file are simple: you add a message for each data structure you want to serialize, then specify a name and a type for each field in the message. Here is the .proto file that defines your messages, addressbook.proto.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>syntax = &quot;proto2&quot;;

package tutorial;

option java_package = &quot;com.example.tutorial&quot;;
option java_outer_classname = &quot;AddressBookProtos&quot;;

message Person {
  required string name = 1;
  required int32 id = 2;
  optional string email = 3;

  enum PhoneType {
    MOBILE = 0;
    HOME = 1;
    WORK = 2;
  }

  message PhoneNumber {
    required string number = 1;
    optional PhoneType type = 2 [default = HOME];
  }

  repeated PhoneNumber phones = 4;
}

message AddressBook {
  repeated Person people = 1;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>As you can see, the syntax is similar to C++ or Java. Let's go through each part of the file and see what it does.</p> <p>The .proto file starts with a package declaration, which helps to prevent naming conflicts between different projects. In Java, the package name is used as the Java package unless you have explicitly specified a java_package, as we have here. Even if you do provide a java_package, you should still define a normal package as well to avoid name collisions in the Protocol Buffers name space as well as in non-Java languages.</p> <p>After the package declaration, you can see two options that are Java-specific: java_package and java_outer_classname.
java_package specifies in what Java package name your generated classes should live. If you don't specify this explicitly, it simply matches the package name given by the package declaration, but these names usually aren't appropriate Java package names (since they usually don't start with a domain name). The java_outer_classname option defines the class name which should contain all of the classes in this file. <strong>If you don't give a java_outer_classname explicitly, it will be generated by converting the file name to camel case. For example, &quot;my_proto.proto&quot; would, by default, use &quot;MyProto&quot; as the outer class name.</strong></p> <p>Next, you have your message definitions. A message is just an aggregate containing a set of typed fields. Many standard simple data types are available as field types, including <strong>bool, int32, float, double, and string</strong>. You can also add further structure to your messages by using other message types as field types – in the above example the Person message contains PhoneNumber messages, while the AddressBook message contains Person messages. You can even define message types nested inside other messages – as you can see, the PhoneNumber type is defined inside Person. <strong>You can also define enum types if you want one of your fields to have one of a predefined list of values</strong> – here you want to specify that a phone number can be one of MOBILE, HOME, or WORK.</p> <p>The &quot; = 1&quot;, &quot; = 2&quot; markers on each element identify the unique &quot;tag&quot; that field uses in the binary encoding. Tag numbers 1-15 require one less byte to encode than higher numbers, so as an optimization you can decide to use those tags for the commonly used or repeated elements, leaving tags 16 and higher for less-commonly used optional elements. Each element in a repeated field requires re-encoding the tag number, so repeated fields are particularly good candidates for this optimization.</p> <p>Each field must be annotated with one of the following modifiers:</p> <ul><li><p>required: a value for the field must be provided, otherwise the message will be considered &quot;uninitialized&quot;. Trying to build an uninitialized message will throw a RuntimeException. Parsing an uninitialized message will throw an IOException. Other than this, a required field behaves exactly like an optional field.</p></li> <li><p>optional: the field may or may not be set. If an optional field value isn't set, a default value is used. For simple types, you can specify your own default value, as we've done for the phone number type in the example. Otherwise, a system default is used: zero for numeric types, the empty string for strings, false for bools. For embedded messages, the default value is always the &quot;default instance&quot; or &quot;prototype&quot; of the message, which has none of its fields set. Calling the accessor to get the value of an optional (or required) field which has not been explicitly set always returns that field's default value.</p></li> <li><p>repeated: the field may be repeated any number of times (including zero). The order of the repeated values will be preserved in the protocol buffer. Think of repeated fields as dynamically sized arrays.</p></li></ul> <p>Required Is Forever You should be very careful about marking fields as required. If at some point you wish to stop writing or sending a required field, it will be problematic to change the field to an optional field – old readers will consider messages without this field to be incomplete and may reject or drop them unintentionally. You should consider writing application-specific custom validation routines for your buffers instead. Some engineers at Google have come to the conclusion that using required does more harm than good; they prefer to use only optional and repeated. However, this view is not universal.</p> <p>You'll find a complete guide to writing .proto files – including all the possible field types – in the Protocol Buffer Language Guide. Don't go looking for facilities similar to class inheritance, though – protocol buffers don't do that.</p> <h2 id="compiling-your-protocol-buffers"><a href="#compiling-your-protocol-buffers" class="header-anchor">#</a> Compiling Your Protocol Buffers</h2> <p>Now that you have a .proto, the next thing you need to do is generate the classes you'll need to read and write AddressBook (and hence Person and PhoneNumber) messages. To do this, you need to run the protocol buffer compiler protoc on your .proto:</p> <ol><li><p>If you haven't installed the compiler, download the package and follow the instructions in the README.</p></li> <li><p>Now run the compiler, specifying the source directory (where your application's source code lives – the current directory is used if you don't provide a value), the destination directory (where you want the generated code to go; often the same as $SRC_DIR), and the path to your .proto. In this case, you...:</p></li></ol> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>protoc -I<span class="token operator">=</span><span class="token variable">$SRC_DIR</span> --java_out<span class="token operator">=</span><span class="token variable">$DST_DIR</span> <span class="token variable">$SRC_DIR</span>/addressbook.proto
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Because you want Java classes, you use the --java_out option – similar options are provided for other supported languages.
This generates com/example/tutorial/AddressBookProtos.java in your specified destination directory.</p> <h2 id="the-protocol-buffer-api"><a href="#the-protocol-buffer-api" class="header-anchor">#</a> The Protocol Buffer API</h2> <p>Let's look at some of the generated code and see what classes and methods the compiler has created for you. If you look in <strong>AddressBookProtos.java</strong>, you can see that it defines a class called AddressBookProtos, nested within which is a class for each message you specified in addressbook.proto. Each class has its own Builder class that you use to create instances of that class. You can find out more about builders in the Builders vs. Messages section below.</p> <p>Both messages and builders have auto-generated accessor methods for each field of the message; messages have only getters while builders have both getters and setters. Here are some of the accessors for the Person class (implementations omitted for brevity):</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// required string name = 1;
public boolean hasName();
public String getName();

// required int32 id = 2;
public boolean hasId();
public int getId();

// optional string email = 3;
public boolean hasEmail();
public String getEmail();

// repeated .tutorial.Person.PhoneNumber phones = 4;
public List&lt;PhoneNumber&gt; getPhonesList();
public int getPhonesCount();
public PhoneNumber getPhones(int index);

Meanwhile, Person.Builder has the same getters plus setters:

// required string name = 1;
public boolean hasName();
public java.lang.String getName();
public Builder setName(String value);
public Builder clearName();

// required int32 id = 2;
public boolean hasId();
public int getId();
public Builder setId(int value);
public Builder clearId();

// optional string email = 3;
public boolean hasEmail();
public String getEmail();
public Builder setEmail(String value);
public Builder clearEmail();

// repeated .tutorial.Person.PhoneNumber phones = 4;
public List&lt;PhoneNumber&gt; getPhonesList();
public int getPhonesCount();
public PhoneNumber getPhones(int index);
public Builder setPhones(int index, PhoneNumber value);
public Builder addPhones(PhoneNumber value);
public Builder addAllPhones(Iterable&lt;PhoneNumber&gt; value);
public Builder clearPhones();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>As you can see, there are simple JavaBeans-style getters and setters for each field. There are also has getters for each singular field which return true if that field has been set. Finally, each field has a clear method that un-sets the field back to its empty state.</p> <p>Repeated fields have some extra methods – a Count method (which is just shorthand for the list's size), getters and setters which get or set a specific element of the list by index, an add method which appends a new element to the list, and an addAll method which adds an entire container full of elements to the list.</p> <p>Notice how these accessor methods use camel-case naming, even though the .proto file uses lowercase-with-underscores. This transformation is done automatically by the protocol buffer compiler so that the generated classes match standard Java style conventions. You should always use lowercase-with-underscores for field names in your .proto files; this ensures good naming practice in all the generated languages. See the style guide for more on good .proto style.</p> <p>For more information on exactly what members the protocol compiler generates for any particular field definition, see the Java generated code reference.</p> <h2 id="enums-and-nested-classes"><a href="#enums-and-nested-classes" class="header-anchor">#</a> Enums and Nested Classes</h2> <p>The generated code includes a PhoneType Java 5 enum, nested within Person:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static enum PhoneType {
  MOBILE(0, 0),
  HOME(1, 1),
  WORK(2, 2),
  ;
  ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The nested type Person.PhoneNumber is generated, as you'd expect, as a nested class within Person.</p> <h2 id="builders-vs-messages"><a href="#builders-vs-messages" class="header-anchor">#</a> Builders vs. Messages</h2> <p>The message classes generated by the protocol buffer compiler are all immutable. Once a message object is constructed, it cannot be modified, just like a Java String. To construct a message, you must first construct a builder, set any fields you want to set to your chosen values, then call the builder's build() method.</p> <p>You may have noticed that each method of the builder which modifies the message returns another builder. The returned object is actually the same builder on which you called the method. It is returned for convenience so that you can string several setters together on a single line of code.</p> <p>Here's an example of how you would create an instance of Person:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Person</span> john <span class="token operator">=</span>
  <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">&quot;jdoe@example.com&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addPhones</span><span class="token punctuation">(</span>
      <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token class-name">PhoneNumber</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token string">&quot;555-4321&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token class-name">PhoneType</span><span class="token punctuation">.</span>HOME<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Standard Message Methods</p> <p>Each message and builder class also contains a number of other methods that let you check or manipulate the entire message, including:</p> <ul><li>isInitialized(): checks if all the required fields have been set.</li> <li>toString(): returns a human-readable representation of the message, particularly useful for debugging.</li> <li>mergeFrom(Message other): (builder only) merges the contents of other into this message, overwriting singular scalar fields, merging composite fields, and concatenating repeated fields.</li> <li>clear(): (builder only) clears all the fields back to the empty state.</li></ul> <p>These methods implement the Message and Message.Builder interfaces shared by all Java messages and builders. For more information, see the complete API documentation for Message.</p> <h2 id="parsing-and-serialization"><a href="#parsing-and-serialization" class="header-anchor">#</a> Parsing and Serialization</h2> <p>Finally, each protocol buffer class has methods for writing and reading messages of your chosen type using the protocol buffer binary format. These include:</p> <ul><li>byte[] toByteArray();: serializes the message and returns a byte array containing its raw bytes.</li> <li>static Person parseFrom(byte[] data);: parses a message from the given byte array.</li> <li>void writeTo(OutputStream output);: serializes the message and writes it to an OutputStream.</li> <li>static Person parseFrom(InputStream input);: reads and parses a message from an InputStream.</li></ul> <p>These are just a couple of the options provided for parsing and serialization. Again, see the Message API reference for a complete list.</p> <blockquote><p>Protocol Buffers and O-O Design Protocol buffer classes are basically dumb data holders (like structs in C); they don't make good first class citizens in an object model. If you want to add richer behaviour to a generated class, the best way to do this is to wrap the generated protocol buffer class in an application-specific class. Wrapping protocol buffers is also a good idea if you don't have control over the design of the .proto file (if, say, you're reusing one from another project). In that case, you can use the wrapper class to craft an interface better suited to the unique environment of your application: hiding some data and methods, exposing convenience functions, etc. You should never add behaviour to the generated classes by inheriting from them. This will break internal mechanisms and is not good object-oriented practice anyway.</p></blockquote> <h2 id="writing-a-message"><a href="#writing-a-message" class="header-anchor">#</a> Writing A Message</h2> <p>Now let's try using your protocol buffer classes. The first thing you want your address book application to be able to do is write personal details to your address book file. To do this, you need to create and populate instances of your protocol buffer classes and then write them to an output stream.</p> <p>Here is a program which reads an AddressBook from a file, adds one new Person to it based on user input, and writes the new AddressBook back out to the file again. The parts which directly call or reference code generated by the protocol compiler are highlighted.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import com.example.tutorial.AddressBookProtos.AddressBook;
import com.example.tutorial.AddressBookProtos.Person;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.InputStreamReader;
import java.io.IOException;
import java.io.PrintStream;

class AddPerson {
  // This function fills in a Person message based on user input.
  static Person PromptForAddress(BufferedReader stdin,
                                 PrintStream stdout) throws IOException {
    Person.Builder person = Person.newBuilder();

    stdout.print(&quot;Enter person ID: &quot;);
    person.setId(Integer.valueOf(stdin.readLine()));

    stdout.print(&quot;Enter name: &quot;);
    person.setName(stdin.readLine());

    stdout.print(&quot;Enter email address (blank for none): &quot;);
    String email = stdin.readLine();
    if (email.length() &gt; 0) {
      person.setEmail(email);
    }

    while (true) {
      stdout.print(&quot;Enter a phone number (or leave blank to finish): &quot;);
      String number = stdin.readLine();
      if (number.length() == 0) {
        break;
      }

      Person.PhoneNumber.Builder phoneNumber =
        Person.PhoneNumber.newBuilder().setNumber(number);

      stdout.print(&quot;Is this a mobile, home, or work phone? &quot;);
      String type = stdin.readLine();
      if (type.equals(&quot;mobile&quot;)) {
        phoneNumber.setType(Person.PhoneType.MOBILE);
      } else if (type.equals(&quot;home&quot;)) {
        phoneNumber.setType(Person.PhoneType.HOME);
      } else if (type.equals(&quot;work&quot;)) {
        phoneNumber.setType(Person.PhoneType.WORK);
      } else {
        stdout.println(&quot;Unknown phone type.  Using default.&quot;);
      }

      person.addPhones(phoneNumber);
    }

    return person.build();
  }

  // Main function:  Reads the entire address book from a file,
  //   adds one person based on user input, then writes it back out to the same
  //   file.
  public static void main(String[] args) throws Exception {
    if (args.length != 1) {
      System.err.println(&quot;Usage:  AddPerson ADDRESS_BOOK_FILE&quot;);
      System.exit(-1);
    }

    AddressBook.Builder addressBook = AddressBook.newBuilder();

    // Read the existing address book.
    try {
      addressBook.mergeFrom(new FileInputStream(args[0]));
    } catch (FileNotFoundException e) {
      System.out.println(args[0] + &quot;: File not found.  Creating a new file.&quot;);
    }

    // Add an address.
    addressBook.addPerson(
      PromptForAddress(new BufferedReader(new InputStreamReader(System.in)),
                       System.out));

    // Write the new address book back to disk.
    FileOutputStream output = new FileOutputStream(args[0]);
    addressBook.build().writeTo(output);
    output.close();
  }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><h2 id="reading-a-message"><a href="#reading-a-message" class="header-anchor">#</a> Reading A Message</h2> <p>Of course, an address book wouldn't be much use if you couldn't get any information out of it! This example reads the file created by the above example and prints all the information in it.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>tutorial</span><span class="token punctuation">.</span><span class="token class-name">AddressBookProtos</span><span class="token punctuation">.</span><span class="token class-name">AddressBook</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>tutorial</span><span class="token punctuation">.</span><span class="token class-name">AddressBookProtos</span><span class="token punctuation">.</span><span class="token class-name">Person</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ListPeople</span> <span class="token punctuation">{</span>
  <span class="token comment">// Iterates though all people in the AddressBook and prints info about them.</span>
  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Print</span><span class="token punctuation">(</span><span class="token class-name">AddressBook</span> addressBook<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token operator">:</span> addressBook<span class="token punctuation">.</span><span class="token function">getPeopleList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Person ID: &quot;</span> <span class="token operator">+</span> person<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;  Name: &quot;</span> <span class="token operator">+</span> person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">hasEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;  E-mail address: &quot;</span> <span class="token operator">+</span> person<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token class-name">PhoneNumber</span> phoneNumber <span class="token operator">:</span> person<span class="token punctuation">.</span><span class="token function">getPhonesList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>phoneNumber<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">case</span> MOBILE<span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;  Mobile phone #: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">case</span> HOME<span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;  Home phone #: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">case</span> WORK<span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;  Work phone #: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>phoneNumber<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Main function:  Reads the entire address book from a file and prints all</span>
  <span class="token comment">//   the information inside.</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Usage:  ListPeople ADDRESS_BOOK_FILE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Read the existing address book.</span>
    <span class="token class-name">AddressBook</span> addressBook <span class="token operator">=</span>
      <span class="token class-name">AddressBook</span><span class="token punctuation">.</span><span class="token function">parseFrom</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Print</span><span class="token punctuation">(</span>addressBook<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h2 id="extending-a-protocol-buffer"><a href="#extending-a-protocol-buffer" class="header-anchor">#</a> Extending a Protocol Buffer</h2> <p>Sooner or later after you release the code that uses your protocol buffer, you will undoubtedly want to &quot;improve&quot; the protocol buffer's definition. If you want your new buffers to be backwards-compatible, and your old buffers to be forward-compatible – and you almost certainly do want this – then there are some rules you need to follow. In the new version of the protocol buffer:</p> <ul><li>you must not change the tag numbers of any existing fields.</li> <li>you must not add or delete any required fields.</li> <li>you may delete optional or repeated fields.</li> <li>you may add new optional or repeated fields but you must use fresh tag numbers (i.e. tag numbers that were never used in this protocol buffer, not even by deleted fields).
(There are some exceptions to these rules, but they are rarely used.)</li></ul> <p>If you follow these rules, old code will happily read new messages and simply ignore any new fields. To the old code, optional fields that were deleted will simply have their default value, and deleted repeated fields will be empty. New code will also transparently read old messages. However, keep in mind that new optional fields will not be present in old messages, so you will need to either check explicitly whether they're set with has_, or provide a reasonable default value in your .proto file with [default = value] after the tag number. If the default value is not specified for an optional element, a type-specific default value is used instead: for strings, the default value is the empty string. For booleans, the default value is false. For numeric types, the default value is zero. Note also that if you added a new repeated field, your new code will not be able to tell whether it was left empty (by new code) or never set at all (by old code) since there is no has_ flag for it.</p> <h2 id="advanced-usage"><a href="#advanced-usage" class="header-anchor">#</a> Advanced Usage</h2> <p>Protocol buffers have uses that go beyond simple accessors and serialization. Be sure to explore the Java API reference to see what else you can do with them.</p> <p>One key feature provided by protocol message classes is reflection. You can iterate over the fields of a message and manipulate their values without writing your code against any specific message type. One very useful way to use reflection is for converting protocol messages to and from other encodings, such as XML or JSON. A more advanced use of reflection might be to find differences between two messages of the same type, or to develop a sort of &quot;regular expressions for protocol messages&quot; in which you can write expressions that match certain message contents. If you use your imagination, it's possible to apply Protocol Buffers to a much wider range of problems than you might initially expect!</p> <p>Reflection is provided as part of the Message and Message.Builder interfaces.</p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/2/2020, 12:05:06 PM</span></div></footer> <!----></main> <!----> <div style="display:none;" data-v-319dd33c data-v-319dd33c><div class="comments-wrapper" data-v-319dd33c><div class="valine-wrapper"><div id="valine"></div></div></div></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-a81d141e data-v-a81d141e><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-a81d141e><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-a81d141e></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-a81d141e></path></svg></div></div></div>
    <script src="/assets/js/app.bbad8388.js" defer></script><script src="/assets/js/3.c52288f4.js" defer></script><script src="/assets/js/1.1b2459ea.js" defer></script><script src="/assets/js/29.264eb514.js" defer></script>
  </body>
</html>
